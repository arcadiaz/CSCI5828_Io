doctype html
html
    head
        title IO chat
        link(rel='stylesheet', type='text/css', href='css/styles.css')
        link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css')
        script(src='https://code.jquery.com/jquery-3.2.1.slim.min.js')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js')
        script(src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js')

    script(src='/socket.io/socket.io.js')
    script(src='https://code.jquery.com/jquery-1.11.1.js')
    script.
        $(function () {
            var socket = io();
            $('#chatbox').submit(function () {
                socket.emit('chat message', $('#m').val());
                $('#m').val('');
                return false;
            });
            socket.on('display messages', function (msg) {
                $('#messages').append($('<li>').text(msg));
                var objDiv = document.getElementById("messages");
                objDiv.scrollTop = objDiv.scrollHeight;

                let channel = document.cookie.replace(/(?:(?:^|.*;\s*)channel\s*\=\s*([^;]*).*$)|^.*$/, "$1");
                let username = document.cookie.replace(/(?:(?:^|.*;\s*)username\s*\=\s*([^;]*).*$)|^.*$/, "$1");

                $.get(
                    "getStats/" + username + "/" + channel,
                    {},
                    function (data) {
                        $('#keywords').html('');
                        data.forEach( function (word) {
                            $('#keywords').append($('<li>').text(word.timestamp +  " " + word.message));
                        });
                    }
                );
            });
        });
    body
        h1  Io chat
        div.row
            #chatdiv.col-md-6
                ul#messages
                form#chatbox(action='/')
                    #messageBox.row
                        input#m(autocomplete='off').col-md-10
                        button.col-md-2 Send

            #statsdiv.col-md-6
                p Keywords
                ul#keywords

